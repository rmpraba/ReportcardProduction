
  
<link rel="import" href="..\..\bower_components/polymer/polymer.html">
<dom-module id="single-staff-mapping-card">
  <template>
    <style>
      :host {
        display: block;
      }
        
      
   .content{
     border:2px solid black;  width: 100%;
     height:50%;
    }  
    .newcontent
    {
    
      border: 2px solid black;
      width: 70%;
      height: 356px;
      margin-left: 21%;
      margin-top: 2%;
    }
    .new{
       border: 0px solid black;
      width: 70%;
      height: 199px;
      margin-left: 19%;
      margin-top: 4%;
    }
    .subcard
    {
       @apply(--layout-vertical);
      width: 20%;
      height: 68%;
      margin-left: 5%;
      overflow-x: hidden;
      overflow-y: scroll;
    }
     .subcard1
    {
       @apply(--layout-vertical);
    width: 25%;
    height: 80%;
    margin-left: 42%;
    margin-top: -27%;
    }
    .sectcard
    {
       @apply(--layout-vertical);
      width: 25%;
      height: 70%;
      margin-left: 69%;
      margin-top: -25%;
      overflow-x: hidden;
      overflow-y: scroll;
    }
    #itemcard:nth-child(odd) {
        background-color: white;
       
      }
      #itemcard:nth-child(even) {
        background-color:  #d1d1e0;
      }
      #itemcard{
        margin-left: 7%;
        width: 69%;
      }
    </style>
    <div>  
    <div class="student" id="studrmv">
            <paper-input label="Enter Employee Name" is="" value="{{value}}" on-keydown="FnSearchstudname"></paper-input>
              <paper-listbox class="dropdown-content" id="employeelistid" on-iron-select="FnSelectstudenq">
                <template is="dom-repeat" items="{{itemArray}}" as="item">
                 <paper-item value="{{item.itemid}}">{{item.itemdes}}</paper-item>
                </template>
              </paper-listbox>

    </div>

<button  style="color:white;background-color:black;width: 13%;border-radius: 27%;" on-click="fnemployee">Single Employee Mapping</button>

<iron-collapse horizontal id="singleemployeeid">
 <div class="new">
    <table border="0" style="width: 70%;">
       <tr>
          <th>Grade</th>
          <th>Subject</th>
          <th>Section</th>
       </tr>
     </table>   
         <template is="dom-repeat" items="{{dbarr}}" as="item">
           <!-- <tr>
             <td>{{item.gradename}}</td>
             <td>{{item.subjectname}}</td>
             <td>{{item.section_id}}</td>
           </tr> -->
           <div id="itemcard"><single-employee-bind-card gradename="{{item.gradename}}" subjectname="{{item.subjectname}}" sectionname="{{item.section_id}}"></single-employee-bind-card>
           </div>
         </template>
  </div>

  <div class="newcontent">
      <h3 style="margin-left:3%">Subject Name</h3>
     <div class="subcard">
<template is="dom-repeat" items="{{subjectarr}}" as="item">
   <single-employee-subject-card subjectname="{{item.subject_name}}" subjectid="{{item.subject_id}}">
    </single-employee-subject-card>
</template>  
      </div>
<div  style="margin-top: -7%;">
<h3 style="margin-left: 28%;margin-top: -2.5%;position: absolute;">Grade Name</h3>
 <div class="subcard1">
       <template is="dom-repeat" items="{{gradearr}}" as="item">
         <single-employee-grade-card gradename="{{item.grade_name}}" gradeid="{{item.grade_id}}"></single-employee-grade-card>
       </template>
  </div>
</div>
   
 <div style="margin-top: -7%;">
        <h3 style="margin-left: 46%;margin-top: -3%;position: absolute;">Section Name</h3>
        <div class="sectcard">
          <template is="dom-repeat" items="{{sectionarr}}" as="item">
            <single-employee-section-card sectionid="{{item.section_id}}"  classid="{{item.class_id}}" gradeid="{{item.grade_id}}"></single-employee-section-card>
          </template>
        </div>
     </div>

       <center><paper-button style="background-color:black;color:white;margin-top: 18%;margin-left: -5%;position: absolute;" on-click="fnsubmit">Submit</paper-button></center>
    </div>
    
</iron-collapse>
   </div>
          <student-add-service id="studservice"></student-add-service>

  </template>
  <script>
  (function() {
    'use strict';
  var studentnamearr=[];
  var finallarr=[];
    Polymer({
      is: 'single-staff-mapping-card',
       getstudentdet:function(arr)
     {
        studentnamearr=arr;
    // alert(JSON.stringify(studentnamearr));

     },
   fnfinalvalue:function(arr){
  finallarr=arr;
   },
   fnsubmit:function(e){
    this.subjectids=sessionStorage.getItem("curr_sess_loggedsubjectid");
     this.$.studservice.fnsinglegrademapping(this.empid,finallarr,this.subjectids);
    },
      fnemployee:function(e){
     this.$.singleemployeeid.toggle();
     },
  FnSelectstudenq:function(e)
        {
          this.querySelector('#employeelistid').style.visibility='hidden';
          this.value=e.target.selectedItem.textContent.trim();
          this.empid=e.target.selectedItem.value;
           //alert(this.value+this.studentid);
          this.itemArray=[];
          document.querySelector('#employeelistid').selected=-1;
          this.$.studservice.fnsetsingleemployee(this.empid);
          //alert(this.empid);
          //this.empid=this.studentid;
        },
   FnSearchstudname:function(e)
       {

      if(e.keyCode==13|| e.keyCode==40)
            this.querySelector('#employeelistid').focus();
          var arr=[];
          arr.push({"itemdes":"-----Select-----"});
          this.querySelector('#employeelistid').style.visibility='visible';
          if(e.keyCode==8){
            this.itemflag="true";
            this.itemval="";
            //alert('yes');
            var len=(this.value).length;
            if(len<=1){
              this.querySelector('#employeelistid').style.visibility='hidden';
              this.itemArray="";
              this.itemval="";
            }
            if(len>1){   
      this.querySelector('#employeelistid').style.visibility='visible';
              var backsubval=(((this.value).substring(0,(len-1))).trim()).toUpperCase();
              for(var i=0;i<studentnamearr.length;i++)
              {
                var subval=((studentnamearr[i].emp_name).trim()).substring(0,backsubval.length);
                if((subval).toUpperCase()==(backsubval).toUpperCase())
                {
                  var obj={"itemdes":"","itemid":""};
                  obj.itemdes=studentnamearr[i].emp_name;
                  obj.itemid=studentnamearr[i].emp_id;
                  arr.push(obj);
                }
              }
              this.itemArray=arr;
            }
          }
          if(e.keyCode!=8&& e.keyCode!=16&& e.keyCode!=13 && e.keyCode!=38&&e.keyCode!=40&&e.keyCode!=37&&e.keyCode!=39){
            if(this.itemflag=="true") {
              this.itemval = (this.value).toUpperCase()+String.fromCharCode((e.keyCode)).toUpperCase();
              this.itemflag="false";
            }
            else
            this.itemval = this.value +String.fromCharCode((e.keyCode));
            if(this.itemval.length>0)
            {
              for(var i=0;i<studentnamearr.length;i++){
                var subval=((studentnamearr[i].emp_name).trim()).substring(0,this.itemval.length);
                if((subval).toUpperCase()==(this.itemval).toUpperCase()){
                  var obj={"itemdes":"","itemid":""};
                  obj.itemdes=studentnamearr[i].emp_name;
                  obj.itemid=studentnamearr[i].emp_id;
                  arr.push(obj);
                }
              }
              if(arr.length>0)
                this.itemArray=arr;
              else {
                var obj={"itemdes":"","itemid":""};
                  obj.itemdes=studentnamearr[i].emp_name;
                  obj.itemid=studentnamearr[i].emp_id;
                  arr.push(obj);
                  this.itemArray=arr;
              }
            } }
          },

    });
  })();
  </script>
</dom-module>
